---
id: xmxgf
name: Overview of metadata-booster
file_version: 1.0.2
app_version: 0.9.1-5
file_blobs:
  packages/framework-integration-tests/tsconfig.json: faa039e08e3ec47adff7179d8e0e3390513cb5ab
  packages/framework-integration-tests/package.json: 16c0cc67061af5e471284228c2d91899f01906ed
  packages/metadata-booster/src/index.ts: a3af5e352db7fffe16f902f0295f2a9fa8d97013
  packages/metadata-booster/package.json: 8825534d1a796cfbdeb9615ba8f91c29e7a21b03
---

The `metadata-booster` package ( `ğŸ“„ packages/metadata-booster` ) is a transformer for the TypeScript compiler.

<br/>

A transformer is something like a plugin that extends the compiler functionality, one can configure it in the `tsconfig.json` file of their project, under the `plugins`[<sup id="Z1AqYAw">â†“</sup>](#f-Z1AqYAw) section:
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ğŸ“„ packages/framework-integration-tests/tsconfig.json
```json
â¬œ 19           "ES2019",
â¬œ 20           "ES2020"
â¬œ 21         ],
ğŸŸ© 22         "plugins": [
ğŸŸ© 23           { "transform": "metadata-booster" }
ğŸŸ© 24         ]
â¬œ 25       },
â¬œ 26       "include": [
â¬œ 27         "src/**/*"
```

<br/>

To use this, one has to use a patched TypeScript version, because although the official compiler implements the usage of plugins, it doesn't read the configuration from the `tsconfig.json`file.

<br/>

We're currently advising our users to use `ttypescript`[<sup id="Z1hsRjL">â†“</sup>](#f-Z1hsRjL) as their compiler, because it's what we've tested, but it has a limitation, it performs what's called **after-transformations**, which is consuming the user's code as an input, and adding code to the TypeScript output, _after_ it has been compiled. Therefore, the TypeScript type checking cannot be leveraged in this case.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ğŸ“„ packages/framework-integration-tests/package.json
```json
â¬œ 48         "serverless": "3.8.0",
â¬œ 49         "serverless-artillery": "0.5.2",
â¬œ 50         "subscriptions-transport-ws": "0.9.18",
ğŸŸ© 51         "ttypescript": "1.5.13",
â¬œ 52         "ws": "7.4.5",
â¬œ 53         "yaml": "1.10.2"
â¬œ 54       },
```

<br/>

After adding `ttypescript`[<sup id="Z1hsRjL">â†“</sup>](#f-Z1hsRjL) as a dev dependency , the user needs to change their compile/build script to use `ttsc`[<sup id="nKde1">â†“</sup>](#f-nKde1) instead of `tsc`:
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ğŸ“„ packages/framework-integration-tests/package.json
```json
â¬œ 62         "watch:local": "nodemon --watch ../framework-provider-local/dist --watch ../framework-provider-local-infrastructure --watch dist --exec \"../cli/bin/run start -e local\"",
â¬œ 63         "lint:check": "eslint --ext '.js,.ts' **/*.ts",
â¬œ 64         "lint:fix": "eslint --quiet --fix --ext '.js,.ts' **/*.ts",
ğŸŸ© 65         "compile": "ttsc -b tsconfig.json",
â¬œ 66         "clean": "rimraf ./dist tsconfig.tsbuildinfo",
â¬œ 67         "postinstall": "rimraf ../../node_modules/serverless/node_modules/archiver && echo 'Deleted buggy \"archiver\" module from \"serveless\" dependencies to use the newer hoisted one'",
â¬œ 68         "integration": "npm run integration/cli && npm run integration/local && npm run integration/aws && npm run integration/azure",
```

<br/>

There's an alternative tool, called `ts-patch`, which allows **before-transformations**, but it hasn't been tested because we currently don't need that much power, and when we started the project it didn't exist. And although `ttypescript` is not maintained, while `ts-patch` is, the reality is that the former didn't give us any headaches yet.

What `metadata-booster` does is to parse all classes annotated with a decorator, capture the types of the fields, and adds some specific function calls to the generated code that was generated by the TypeScript compiler, so some reflection information that Booster requires is available.

The source code preprocessing and code generation happens in the `transformer`[<sup id="1oLuyB">â†“</sup>](#f-1oLuyB) function. It leverages `ts-morph`[<sup id="1CSMOI">â†“</sup>](#f-1CSMOI) to handle the code parsing into an [AST](https://en.wikipedia.org/wiki/Abstract_syntax_tree).

* * *

Used files:

<br/>



<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ğŸ“„ packages/metadata-booster/src/index.ts
<!-- collapsed -->

```typescript
â¬œ 1      import * as ts from 'typescript'
â¬œ 2      import { getClassInfo } from './metadata-extractors'
â¬œ 3      import { createClassMetadataDecorator, createFilterInterfaceFunction } from './statement-creators'
ğŸŸ© 4      
ğŸŸ© 5      const transformer: (program: ts.Program) => ts.TransformerFactory<ts.SourceFile> = (program) => {
ğŸŸ© 6        const checker = program.getTypeChecker()
ğŸŸ© 7        const transformerFactory: ts.TransformerFactory<ts.SourceFile> = (context) => {
ğŸŸ© 8          const f = context.factory
ğŸŸ© 9          const filterInterfaceFunctionName = f.createUniqueName('filterInterface')
ğŸŸ© 10         return (sourceFile) => {
ğŸŸ© 11           const importedTypes: Record<string, string> = {}
ğŸŸ© 12           function visitor(node: ts.Node): ts.VisitResult<ts.Node> {
ğŸŸ© 13             if (ts.isImportDeclaration(node)) {
ğŸŸ© 14               // To ensure we import 'reflect-metadata', delete it from the file in case it is already there.
ğŸŸ© 15               // Later we will add it.
ğŸŸ© 16               const quotedModuleName = node.moduleSpecifier.getText()
ğŸŸ© 17               const moduleName = quotedModuleName.replace(/['']/g, '')
ğŸŸ© 18               if (moduleName == 'reflect-metadata') {
ğŸŸ© 19                 return undefined
ğŸŸ© 20               }
ğŸŸ© 21               const namedBindings = node.importClause?.namedBindings
ğŸŸ© 22               if (namedBindings && 'elements' in namedBindings) {
ğŸŸ© 23                 const setImportedType = (elem: ts.ImportSpecifier): string =>
ğŸŸ© 24                   (importedTypes[elem.name.getText()] = moduleName)
ğŸŸ© 25                 namedBindings.elements.forEach(setImportedType)
ğŸŸ© 26               }
ğŸŸ© 27             }
ğŸŸ© 28     
ğŸŸ© 29             if (ts.isClassDeclaration(node)) {
ğŸŸ© 30               const classInfo = getClassInfo(node, checker)
ğŸŸ© 31               if (classInfo) {
ğŸŸ© 32                 const metadataDecorator = createClassMetadataDecorator(
ğŸŸ© 33                   f,
ğŸŸ© 34                   classInfo,
ğŸŸ© 35                   filterInterfaceFunctionName,
ğŸŸ© 36                   importedTypes
ğŸŸ© 37                 )
ğŸŸ© 38                 const newDecorators = [...(node.decorators ?? []), metadataDecorator]
ğŸŸ© 39                 return f.updateClassDeclaration(
ğŸŸ© 40                   node,
ğŸŸ© 41                   newDecorators,
ğŸŸ© 42                   node.modifiers,
ğŸŸ© 43                   node.name,
ğŸŸ© 44                   node.typeParameters,
ğŸŸ© 45                   node.heritageClauses,
ğŸŸ© 46                   node.members
ğŸŸ© 47                 )
ğŸŸ© 48               }
ğŸŸ© 49             }
ğŸŸ© 50             return ts.visitEachChild(node, visitor, context)
ğŸŸ© 51           }
ğŸŸ© 52           const modifiedSourceFile = ts.visitNode(sourceFile, visitor)
ğŸŸ© 53           return f.updateSourceFile(modifiedSourceFile, [
ğŸŸ© 54             f.createImportDeclaration(undefined, undefined, undefined, f.createStringLiteral('reflect-metadata')),
ğŸŸ© 55             ...modifiedSourceFile.statements,
ğŸŸ© 56             createFilterInterfaceFunction(f, filterInterfaceFunctionName),
ğŸŸ© 57           ])
ğŸŸ© 58         }
ğŸŸ© 59       }
ğŸŸ© 60     
ğŸŸ© 61       return transformerFactory
ğŸŸ© 62     }
ğŸŸ© 63     
â¬œ 64     export default transformer
â¬œ 65     export * from './metadata-types'
â¬œ 66     
```

<br/>

<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ğŸ“„ packages/metadata-booster/package.json
<!-- collapsed -->

```json
ğŸŸ© 1      {
ğŸŸ© 2        "name": "@boostercloud/metadata-booster",
ğŸŸ© 3        "version": "0.29.6",
ğŸŸ© 4        "description": "Emits detailed metadata of your types. You can then get it in runtime to deal with schema-aware operation, like defining GraphQL schemas, ORM operations, etc.",
ğŸŸ© 5        "repository": "https://github.com/boostercloud/booster.git",
ğŸŸ© 6        "keywords": [
ğŸŸ© 7          "metadata",
ğŸŸ© 8          "transformer",
ğŸŸ© 9          "booster",
ğŸŸ© 10         "reflect"
ğŸŸ© 11       ],
ğŸŸ© 12       "author": "Booster Cloud",
ğŸŸ© 13       "license": "Apache-2.0",
ğŸŸ© 14       "bugs": {
ğŸŸ© 15         "url": "https://github.com/boostercloud/booster/issues"
ğŸŸ© 16       },
ğŸŸ© 17       "homepage": "https://github.com/boostercloud/booster#readme",
ğŸŸ© 18       "main": "dist/index.js",
ğŸŸ© 19       "files": [
ğŸŸ© 20         "dist"
ğŸŸ© 21       ],
ğŸŸ© 22       "dependencies": {
ğŸŸ© 23         "tslib": "2.3.1",
ğŸŸ© 24         "ts-morph": "13.0.2",
ğŸŸ© 25         "reflect-metadata": "0.1.13"
ğŸŸ© 26       },
ğŸŸ© 27       "devDependencies": {
ğŸŸ© 28         "@types/node": "16.11.7",
ğŸŸ© 29         "ttypescript": "1.5.13",
ğŸŸ© 30         "typescript": "4.5.4"
ğŸŸ© 31       },
ğŸŸ© 32       "scripts": {
ğŸŸ© 33         "lint:check": "eslint --ext '.js,.ts' **/*.ts",
ğŸŸ© 34         "lint:fix": "eslint --quiet --fix --ext '.js,.ts' **/*.ts",
ğŸŸ© 35         "compile": "tsc -b tsconfig.json",
ğŸŸ© 36         "prepack": "tsc -b tsconfig.json",
ğŸŸ© 37         "test": "ttsc -p tsconfig.test.json"
ğŸŸ© 38       }
ğŸŸ© 39     }
ğŸŸ© 40     
```

<br/>

<!-- THIS IS AN AUTOGENERATED SECTION. DO NOT EDIT THIS SECTION DIRECTLY -->
### Swimm Note

<span id="f-Z1AqYAw">plugins</span>[^](#Z1AqYAw) - "packages/framework-integration-tests/tsconfig.json" L22
```json
    "plugins": [
```

<span id="f-1oLuyB">transformer</span>[^](#1oLuyB) - "packages/metadata-booster/src/index.ts" L5
```typescript
const transformer: (program: ts.Program) => ts.TransformerFactory<ts.SourceFile> = (program) => {
```

<span id="f-1CSMOI">ts-morph</span>[^](#1CSMOI) - "packages/metadata-booster/package.json" L24
```json
    "ts-morph": "13.0.2",
```

<span id="f-nKde1">ttsc</span>[^](#nKde1) - "packages/framework-integration-tests/package.json" L65
```json
    "compile": "ttsc -b tsconfig.json",
```

<span id="f-Z1hsRjL">ttypescript</span>[^](#Z1hsRjL) - "packages/framework-integration-tests/package.json" L51
```json
    "ttypescript": "1.5.13",
```

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBYm9vc3RlciUzQSUzQWJvb3N0ZXJjbG91ZA==/docs/xmxgf).